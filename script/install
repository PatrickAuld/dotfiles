#!/usr/bin/env bash
#
# Run all dotfiles installers.

set -euo pipefail

cd "$(dirname "$0")/.."
DOTFILES_ROOT=$(pwd -P)

# shellcheck source=script/util.sh
source "$DOTFILES_ROOT/script/util.sh"

if is_darwin; then
  echo "â€º brew bundle"
  brew bundle

  find . -name install.sh | while read -r installer; do
    "$installer"
  done

elif is_linux; then
  if [ -x linux/install.sh ]; then
    linux/install.sh
  fi

  # run installers excluding known macOS-only folders (they are guarded too)
  find . -name install.sh \
    ! -path "./macos/*" \
    ! -path "./homebrew/*" \
    ! -path "./hammerspoon/*" \
    | while read -r installer; do
      "$installer"
    done
else
  echo "Unsupported OS: $(uname -s)" >&2
  exit 1
fi
